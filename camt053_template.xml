<?xml version="1.0" encoding="UTF-8"?>
<Document xmlns="urn:iso:std:iso:20022:tech:xsd:camt.053.001.02"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="urn:iso:std:iso:20022:tech:xsd:camt.053.001.02 camt.053.001.02.xsd">
    <BkToCstmrStmt>
        <GrpHdr>
            <MsgId>{{ msg_id }}</MsgId>
            <CreDtTm>{{ creation_datetime }}</CreDtTm>
        </GrpHdr>

        <Stmt>
            <ElctrncSeqNb>{{ "%06d" % statements|length }}</ElctrncSeqNb>
            <LglSeqNb>{{ statements|last.seq_nb }}</LglSeqNb>
            <CreDtTm>{{ creation_datetime }}</CreDtTm>

            <!-- Rekeningidentificatie -->
            <Acct>
                <Id>
                    <IBAN>{{ iban }}</IBAN>
                </Id>
                <Ccy>EUR</Ccy>
            </Acct>

            {% for stmt in statements %}
            <Bal>
                <Tp>
                    <Cd>OPBD</Cd> <!-- Opening Balance -->
                </Tp>
                <Amt Ccy="EUR">{{ "%.2f" % stmt.opening_balance }}</Amt>
                <CdtDbtInd>{% if stmt.opening_balance >= 0 %}CRDT{% else %}DBIT{% endif %}</CdtDbtInd>
                <Dt><Dt>{{ stmt.date }}</Dt></Dt>
            </Bal>
            {% endfor %}

            <!-- Alle mutaties per dag -->
            {% for stmt in statements %}
                {% for entry in stmt.entries %}
                <Ntry>
                    <Amt Ccy="EUR">{{ "%.2f" % entry.amt }}</Amt>
                    <CdtDbtInd>{{ entry.sign }}</CdtDbtInd>
                    <Sts>BOOK</Sts>
                    <BookgDt><Dt>{{ stmt.date }}</Dt></BookgDt>
                    <ValDt><Dt>{{ stmt.date }}</Dt></ValDt>

                    <AcctSvcrRef>{{ stmt.id }}</AcctSvcrRef>
                    <BkTxCd>
                        <Domn>
                            <Cd>{{ entry.dom }}</Cd>
                            <Fmly>
                                <Cd>{{ entry.fam }}</Cd>
                                <SubFmlyCd>{{ entry.sub }}</SubFmlyCd>
                            </Fmly>
                        </Domn>
                    </BkTxCd>

                    <NtryDtls>
                        <TxDtls>
                            <Refs>
                                <EndToEndId>NOTPROVIDED</EndToEndId>
                            </Refs>
                            <RltdPties>
                                <Dbtr>
                                    <Nm>Kassa dagelijks</Nm>
                                </Dbtr>
                            </RltdPties>
                            <RmtInf>
                                <Ustrd>{{ entry.desc | escape }}</Ustrd>
                            </RmtInf>
                        </TxDtls>
                    </NtryDtls>
                </Ntry>
                {% endfor %}

                <!-- Eindsaldo van de dag -->
                <Bal>
                    <Tp>
                        <Cd>CLBD</Cd> <!-- Closing Balance -->
                    </Tp>
                    <Amt Ccy="EUR">{{ "%.2f" % stmt.closing_balance }}</Amt>
                    <CdtDbtInd>{% if stmt.closing_balance >= 0 %}CRDT{% else %}DBIT{% endif %}</CdtDbtInd>
                    <Dt><Dt>{{ stmt.date }}</Dt></Dt>
                </Bal>
            {% endfor %}
        </Stmt>
    </BkToCstmrStmt>
</Document>
