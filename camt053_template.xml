<?xml version="1.0" encoding="UTF-8"?>
<Document xmlns="urn:iso:std:iso:20022:tech:xsd:camt.053.001.02">
  <BkToCstmrStmt>
    <GrpHdr>
      <MsgId>{{ msg_id }}</MsgId>
      <CreDtTm>{{ creation_datetime }}</CreDtTm>
    </GrpHdr>

    <Stmt>
      <ElctrncSeqNb>{{ statements|last.seq_nb }}</ElctrncSeqNb>
      <CreDtTm>{{ creation_datetime }}</CreDtTm>

      <Acct>
        <Id><IBAN>{{ iban }}</IBAN></Id>
        <Ccy>EUR</Ccy>
      </Acct>

      <!-- 1. Enkele Opening Balance (beginsaldo hele periode) -->
      <Bal>
        <Tp><CdOrPrtry><Cd>OPBD</Cd></CdOrPrtry></Tp>
        <Amt Ccy="EUR">{{ "%.2f" % (statements|first.opening_balance|float|abs) }}</Amt>
        <CdtDbtInd>{% if statements|first.opening_balance >= 0 %}CRDT{% else %}DBIT{% endif %}</CdtDbtInd>
        <Dt><Dt>{{ statements|first.date }}</Dt></Dt>
      </Bal>

      <!-- Alle transacties chronologisch -->
      {% for stmt in statements %}
        {% for entry in stmt.entries %}
        <Ntry>
          <Amt Ccy="EUR">{{ "%.2f" % entry.amt }}</Amt>
          <CdtDbtInd>{{ entry.sign }}</CdtDbtInd>
          <Sts>BOOK</Sts>
          <BookgDt><Dt>{{ stmt.date }}</Dt></BookgDt>
          <ValDt><Dt>{{ stmt.date }}</Dt></ValDt>
          <AcctSvcrRef>{{ stmt.id }}</AcctSvcrRef>
          <BkTxCd>
            <Domn>
              <Cd>{{ entry.dom }}</Cd>
              <Fmly><Cd>{{ entry.fam }}</Cd><SubFmlyCd>{{ entry.sub }}</SubFmlyCd></Fmly>
            </Domn>
          </BkTxCd>
          <NtryDtls>
            <TxDtls>
              <RmtInf><Ustrd>{{ entry.desc | escape }}</Ustrd></RmtInf>
            </TxDtls>
          </NtryDtls>
        </Ntry>
        {% endfor %}
      {% endfor %}

      <!-- 2. Enkele Closing Balance (eindsaldo hele periode) -->
      <Bal>
        <Tp><CdOrPrtry><Cd>CLBD</Cd></CdOrPrtry></Tp>
        <Amt Ccy="EUR">{{ "%.2f" % (statements|last.closing_balance|float|abs) }}</Amt>
        <CdtDbtInd>{% if statements|last.closing_balance >= 0 %}CRDT{% else %}DBIT{% endif %}</CdtDbtInd>
        <Dt><Dt>{{ statements|last.date }}</Dt></Dt>
      </Bal>

    </Stmt>
  </BkToCstmrStmt>
</Document>
